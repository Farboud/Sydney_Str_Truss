                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
!********************************************************************************************************************************************                                                                                                                                                                                                                                                                                                                                                                       
!	!programme to analyse 2-d trusses considering nodal nodes                                                                                                                                                                                                                                                                                                                                                                                                                        
!	!by farboud khatami and ehsan torkaman                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
!	!year 1392-93 / 2013                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
!********************************************************************************************************************************************                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
	program truss_analysis							!main programme                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
!modules-------------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
! the following use statement provides fortran interfaces to win32 routines                                                                                                                                                                                                                                                                                                                                                                                                                                         
     use dfwin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 ! use statements to include routine interfaces                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    use dflib                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    use dfwin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
!variable declerations-----------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
! begin data declarations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	implicit real*8 (a-z)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    integer lines,length                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    logical status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    integer handlee                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	integer nlines, ncols                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    logical lstat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    type(t_coord) wpos                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	type(t_small_rect) sr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    type(t_console_screen_buffer_info) cinfo                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	character(len=1) :: result                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
	integer i,j,xx,yy,ii,qq	,number					!counters                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
	integer num_node								!the number of nodes                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	integer num_elem								!the number of elements                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	integer num_sup									!the number of supported nodes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
	integer num_def									!the number of supports with a deflection                                                                                                                                                                                                                                                                                                                                                                                                                                                  
	integer support									!defines the type of support                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	integer num_load								!the number of loaded elements                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	integer ld										!defines the type of load on the members                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	integer count									!the number of free degrees of freedom                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	integer countf									!free degrees of freedom counter                                                                                                                                                                                                                                                                                                                                                                                                                                                            
	integer counts									!secured degrees of freedom counter                                                                                                                                                                                                                                                                                                                                                                                                                                                         
	real*8 :: area, e, mi,QQQ							!a, e, and i of a member                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	real*8 , allocatable, dimension(:)::  load		!x_load, y_load, and moment of each node respectively                                                                                                                                                                                                                                                                                                                                                                                                                  
	real*8 , allocatable, dimension(:)::  force		!x_force, y_force, and moment of each node respectively ==> the answer                                                                                                                                                                                                                                                                                                                                                                                                
	real*8 , allocatable, dimension(:)::  fem		!fixed end x_force,y_force and moment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	real*8 , allocatable, dimension(:,:)::fem_el     !newwwwwwwwww
	REAL*8 , ALLOCATABLE, DIMENSION(:)::  F_EL	     !NEWWWWWWWWWW                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	real*8 , allocatable, dimension(:)::  scu        !newwwwwwwwww                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	real*8 , allocatable, dimension(:)::  delta_el   !nwwwwwwwwwww                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	real*8 , allocatable, dimension(:)::  femtemp	!a temporarily fem                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	real*8 , allocatable, dimension(:)::  disp		!x_displacement, y_displacement, and rotation of each node respectively                                                                                                                                                                                                                                                                                                                                                                                                
	real*8 , allocatable, dimension(:)::  dof		!nodes degree of freedom in the x, y, and moment direction respectively                                                                                                                                                                                                                                                                                                                                                                                                 
	real*8 , allocatable, dimension(:,:)::node		!node co-ordinates (x,y)                                                                                                                                                                                                                                                                                                                                                                                                                                               
	real*8 , allocatable, dimension(:,:)::nodenum	!element11 & element12                                                                                                                                                                                                                                                                                                                                                                                                                                               
	real*8 , allocatable, dimension(:,:)::element	!element co-ordinates and data (element_number-x1-y1-x2-y2-l-thetha(rad)-e-i-a-node1-node2-node1x-node1y-node2x-node2y)                                                                                                                                                                                                                                                                                                                                              
	real*8 , allocatable, dimension(:,:)::element_backup !newwwwwwwwwwwwwwww                                                                                                                                                                                                                                                                                                                                                                                                                                           
	real*8 , allocatable, dimension(:,:)::kl		!local stiffnes matrix of an element                                                                                                                                                                                                                                                                                                                                                                                                                                     
	real*8 , allocatable, dimension(:,:)::kg		!global stiffnes matrix of an element                                                                                                                                                                                                                                                                                                                                                                                                                                    
	real*8 , allocatable, dimension(:,:)::k			!global stiffnes matrix of the structure                                                                                                                                                                                                                                                                                                                                                                                                                                 
	real*8 , allocatable, dimension(:,:)::t			!transposition matrix                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	real*8 , allocatable, dimension(:,:)::kf		!free stiffness matrix                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	real*8 , allocatable, dimension(:,:)::kfinv		!inverse of free stiffness matrix                                                                                                                                                                                                                                                                                                                                                                                                                                     
	real*8 , allocatable, dimension(:)::  femf		!free fem                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	real*8 , allocatable, dimension(:,:)::kfs		!free-secured sfiffness matrix                                                                                                                                                                                                                                                                                                                                                                                                                                          
	real*8 , allocatable, dimension(:)  ::deltaf	!delta f                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	real*8 , allocatable, dimension(:)  ::deltas	!delta s  
	REAL*8 , ALLOCATABLE, DIMENSION(:,:)::S_DEF 	!A SET OF DEFLECTED SUPPORTS, THEIR DOF NUMBER AND THEIR MAGNITUDE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	character (len=1)::verify						!y or n      
	character (len=1)::truss                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	open(3,file="output.txt")						!the output.txt file                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
!screen setup-----------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                                
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	fhandle = getstdhandle(std_output_handle)                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
! executable code to set console window size                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    sr.top    =   0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	sr.left   =   0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    sr.bottom =   56 ! 56! <= console buffer height -1                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    sr.right  =   79 ! 79! <= console buffer width  -1                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    lstat = setconsolewindowinfo(fhandle, .true., sr)                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
! executable code to set console buffer size                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
     nlines = 300 !57                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	 ncols  =  80 !80                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
     wpos.x = ncols  ! columns >= console window width                                                                                                                                                                                                                                                                                                                                                                                                                                                              
     wpos.y = nlines ! lines   >= console window height                                                                                                                                                                                                                                                                                                                                                                                                                                                             
     lstat = setconsolescreenbuffersize(fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
!credits							                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	write (*,108) "A 2-D Truss Analysis Programme."                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	write (*,101) "-------------------------------"                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	write (*,103) "Press any key to start"                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	result = getcharqq ( )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
!nodes---------------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (*,102) "Nodes","-----"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
	write (*,104) "Enter the number of nodes: "                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	read (*,*),num_node								!total number of nodes                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
	allocate (node(num_node,2),delta_el(4),F_EL(4),scu(4),load(2*num_node),force(2*num_node),disp(2*num_node),dof(2*num_node),fem(2*num_node),femtemp(2*num_node))                                                                                                                                                                                                                                                                                                                                                     
	allocate (kl(4,4),kg(4,4),k(2*num_node,2*num_node),t(4,4))                                                                                                                                                                                                                                                                                                                                                                                                                                                         
	k=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
	kl=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	kg=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	t=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
	node=0; load=0; force=0; disp=0; fem=0; femtemp=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
	dof=1								!so that the degrees of freedom not be zero by default                                                                                                                                                                                                                                                                                                                                                                                                                                                
	do i=1,num_node                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		write (*,103) "Node number", i,":"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
		write (3,103) "Node number", i,":"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
		write (*,100) "X co-ordinate: (m) "                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		write (3,100) "X co-ordinate: (m) "                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		read (*,*) node(i,1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
		write (3,118) node(i,1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
		write (*,100) "Y co-ordinate: (m) "                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		write (3,100) "Y co-ordinate: (m) "                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		read (*,*) node(i,2)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
		write (3,118) node(i,2)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
		write (3,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
!elements------------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (*,102) "Elements", "--------"                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	write (*,104) "Enter the number of elements: "                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	read (*,*) num_elem																		!total number of elements                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	allocate (element(num_elem,18),element_backup(num_elem,18),fem_el(4,num_elem))                                                                                                                                                                                                                                                                                                                                                                                                                                     
	element=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
	do i=1,num_elem                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		element(i,1)=i																		!the number of element                                                                                                                                                                                                                                                                                                                                                                                                                                                            
		write (*,105)"Element number",i,":"                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		write (*,100)"The number of node at the first point of member : "                                                                                                                                                                                                                                                                                                                                                                                                                                                 
		read (*,*) element (i,11)															!node1                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		write (*,100)"The number of node at the second point of member: "                                                                                                                                                                                                                                                                                                                                                                                                                                                 
		read (*,*) element (i,12)															!node2                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		element(i,2)=node(element (i,11),1)													!x1                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		element(i,3)=node(element (i,11),2)													!y1	                                                                                                                                                                                                                                                                                                                                                                                                                                                              
		element(i,4)=node(element (i,12),1)													!x2                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		element(i,5)=node(element (i,12),2)													!y2                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		element(i,6)=sqrt((element(i,3)-element(i,5))**2+(element(i,2)-element(i,4))**2)	!lenght of member																	                                                                                                                                                                                                                                                                                                                                                                                               
		element(i,7)=atan((element(i,5)-element(i,3))/(element(i,4)-element(i,2)))			!theta (rad)																                                                                                                                                                                                                                                                                                                                                                                                                         
		element (i,13)=node(element (i,11),1)												!node 1 x                                                                                                                                                                                                                                                                                                                                                                                                                                                        
		element (i,14)=node(element (i,11),2)												!node 1 y                                                                                                                                                                                                                                                                                                                                                                                                                                                        
		element (i,15)=node(element (i,12),1)												!node 2 x                                                                                                                                                                                                                                                                                                                                                                                                                                                        
		element (i,16)=node(element (i,12),2)												!node 2 y                                                                                                                                                                                                                                                                                                                                                                                                                                                        
		element (i,17)=(element(i,4)-element(i,2))/element(i,6)										!cos thetha		                                                                                                                                                                                                                                                                                                                                                                                                                                    
		element (i,18)=(element(i,5)-element(i,3))/element(i,6)										!sin thetha                                                                                                                                                                                                                                                                                                                                                                                                                                      
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
!elements area-------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (*,102) "Section properties", "------------------", "Cross-section area"				!section properties                                                                                                                                                                                                                                                                                                                                                                                                              
	num=num_elem                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	do i=1,num                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
		write (*,103) "Element number", i,":"                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
		number=i                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
		write (*,100) "Cross-section area? (mm^2) "                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
		read (*,*) area                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
		element(number,10)=area                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       

call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
!elements modulus of elasticity--------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (*,102) "Section properties", "------------------", "Modulus of elasticity"				!section properties                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	num=num_elem											!members with a different modulus of elasticity                                                                                                                                                                                                                                                                                                                                                                                                                                             
	do i=1,num                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
		write (*,103) "Element number", i,":"                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
		number=i                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
		write (*,100) "Eodulus of elasticity? (mpa) "                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
		read (*,*) e                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
		element(number,8)=e                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
!section properties output-------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (3,103) "The members section properties are as follows:"								!section properties verification                                                                                                                                                                                                                                                                                                                                                                                                             
	write (3,106) "no.","E (mpa)","A (mm^4)"                                                                                                                                                                                                                                                                                                                                                                                                                                                            
	write (3,101) "---------------------------------------------------------------------------"                                                                                                                                                                                                                                                                                                                                                                                                                        
	do i=1,num_elem                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		write (3,107) element(i,1), element(i,8) ,element(i,10)                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	write (3,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
!supports------------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	write (*,102) "Supports", "--------"                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	write (*,103) "Support types:"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	write (*,101) "1: pin support"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
	write (*,101) "2: roller support"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	write (*,101) "----------------------------------------"                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	write (*,104) "Enter the number of supported nodes: "                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	read (*,*) num_sup                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	do i=1,num_sup                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
		write (*,104) "The number of node: "                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
		read (*,*) n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
88		write (*,100) "Type of support:"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
		read (*,*) support                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
		select case (support)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
			case (1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
				dof(2*n-1)=0								!x dof                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
				dof(2*n)=0									!y dof                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
			case (2)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
31				write (*,100) "Vertical or horizontal? (v/h)"                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
				read (*,*) verify                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
				if (verify=="v".or.verify=="V") then                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
					dof(2*n-1)=0								!x dof                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
					dof(2*n)=1									!y dof                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
				else if (verify=="h".or.verify=="H") then                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
					dof(2*n-1)=1								!x dof                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
					dof(2*n)=0									!y dof                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
				else                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
					write(*,101), "Typing mistake mate! Try again."                                                                                                                                                                                                                                                                                                                                                                                                                                                                
					goto 31		                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
				end if                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
		case default                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
			write (*,*) "Are you kidding me? Pay more attention to what you type!"                                                                                                                                                                                                                                                                                                                                                                                                                                           
			goto 88                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
		end select                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
!calculations1--------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
  element_backup=element	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	k=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
	do i=1,num_elem                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		kg=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	call kglobal(element(i,8),element(i,10),element(i,6)*1000,cos(element(i,7)),sin(element(i,7)),kg)    
!	do jj=1,4
	!	do ii=1,4
	!	   k(2*element(i,11)-1,2*element(i,11)-1)=k(2*element(i,11)-1,2*element(i,11)-1)+kg(ii,jj)     		       
			
	                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		!assemblage of global stiffness matrix                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
		!first column                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
		k(2*element(i,11)-1,2*element(i,11)-1)=k(2*element(i,11)-1,2*element(i,11)-1)+kg(1,1)                                                                                                                                                                                                                                                                                                                                                                                                                             
		k(2*element(i,11)-0,2*element(i,11)-1)=k(2*element(i,11)-0,2*element(i,11)-1)+kg(2,1)                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                             
		k(2*element(i,12)-1,2*element(i,11)-1)=k(2*element(i,12)-1,2*element(i,11)-1)+kg(3,1)                                                                                                                                                                                                                                                                                                                                                                                                                             
		k(2*element(i,12)-0,2*element(i,11)-1)=k(2*element(i,12)-0,2*element(i,11)-1)+kg(4,1)                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                           
		!second column                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		k(2*element(i,11)-1,2*element(i,11)-0)=k(2*element(i,11)-1,2*element(i,11)-0)+kg(1,2)                                                                                                                                                                                                                                                                                                                                                                                                                             
		k(2*element(i,11)-0,2*element(i,11)-0)=k(2*element(i,11)-0,2*element(i,11)-0)+kg(2,2)                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                             
		k(2*element(i,12)-1,2*element(i,11)-0)=k(2*element(i,12)-1,2*element(i,11)-0)+kg(3,2)                                                                                                                                                                                                                                                                                                                                                                                                                             
		k(2*element(i,12)-0,2*element(i,11)-0)=k(2*element(i,12)-0,2*element(i,11)-0)+kg(4,2)                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
		!fourth column                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		k(2*element(i,11)-1,2*element(i,12)-1)=k(2*element(i,11)-1,2*element(i,12)-1)+kg(1,3)                                                                                                                                                                                                                                                                                                                                                                                                                             
		k(2*element(i,11)-0,2*element(i,12)-1)=k(2*element(i,11)-0,2*element(i,12)-1)+kg(2,3)                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                            
		k(2*element(i,12)-1,2*element(i,12)-1)=k(2*element(i,12)-1,2*element(i,12)-1)+kg(3,3)                                                                                                                                                                                                                                                                                                                                                                                                                             
		k(2*element(i,12)-0,2*element(i,12)-1)=k(2*element(i,12)-0,2*element(i,12)-1)+kg(4,3)                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                            
		!fifth column                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
		k(2*element(i,11)-1,2*element(i,12)-0)=k(2*element(i,11)-1,2*element(i,12)-0)+kg(1,4)                                                                                                                                                                                                                                                                                                                                                                                                                             
		k(2*element(i,11)-0,2*element(i,12)-0)=k(2*element(i,11)-0,2*element(i,12)-0)+kg(2,4)                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                            
		k(2*element(i,12)-1,2*element(i,12)-0)=k(2*element(i,12)-1,2*element(i,12)-0)+kg(3,4)                                                                                                                                                                                                                                                                                                                                                                                                                             
		k(2*element(i,12)-0,2*element(i,12)-0)=k(2*element(i,12)-0,2*element(i,12)-0)+kg(4,4)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                            
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	count=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
	do i=1, 2*num_node                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
		if(dof(i)==1) count=count+1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	allocate(kf(count,count), femf(count),kfs(count,2*num_node-count),deltaf(count),deltas(2*num_node-count),kfinv(count,count))                                                                                                                                                                                                                                                                                                                                                                                       
	fem_el=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
!loading-------------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (*,102) "Loading", "-------"	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
	write (*,103) "-The Principle of Superposition may be required-"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
	write (*,103) "Load cases:"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	write (*,103) "1: concentrated perpendicular load (In Global Co-ordinates)"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
	write (*,101) "2: concentrated tangential load    (In Global Co-ordinates)"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	write (*,101) "----------------------------------------"                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	write (*,104) "Enter the number of loads:"                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
	read (*,*)num_load                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	do i=1,num_load                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		write (*,104) "The number of node: "                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
		read (*,*) n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
19		write (*,100)"Load case: "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
		read (*,*) ld                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
		select case (ld)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
			case (1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
				write(*,100) "Load magnitude? (n) "                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
				read(*,*) p                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
				fem(2*n-1)=fem(2*n-1)+0			!fx                                                                                                                                                                                                                                                                                                                                                                                                                       
				fem(2*n-0)=fem(2*n-0)-p			!fy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
				femtemp=0					                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  					                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
			case (2)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
				write(*,100) "Load magnitude? (n) "                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
				read(*,*) p                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
				fem(2*n-1)=fem(2*n-1)-p			!fx                                                                                                                                                                                                                                                                                                                                                                                                                       
				fem(2*n-0)=fem(2*n-0)+0			!fy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
				femtemp=0					                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  									                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
			case default                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
				write (*,*) "Are you kidding me? Pay more attention to what you type!"                                                                                                                                                                                                                                                                                                                                                                                                                                          
				goto 19                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
		end select                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
!calculations2--------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    kf=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
	femf=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	kfs=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	deltaf=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	deltas=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
						!formation of free stiffness matrix and free nodes forces                                                                                                                                                                                                                                                                                                                                                                                                                                               
	xx=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	do i=1,2*num_node                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
		if(dof(i)==1) then                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
			yy=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
				do j=1,2*num_node                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
					if(dof(j)==1) then                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
						kf(xx,yy)=k(i,j)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
						yy=yy+1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
					end if                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
				end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
			femf(xx)=fem(i)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
			xx=xx+1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
		end if                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
	end do   
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
call inverse(kf,kfinv,count)							!inverse of free stiffness matrix                                                                                                                                                                                                                                                                                                                                                                                                                                                
	deltaf=matmul(kfinv,femf)	!solving the equation for delta f                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	!assemblage of global displacement matrix (delta)                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
	counts=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	countf=1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	do ii=1,2*num_node                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
		if(dof(ii)==0) then                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
			disp(ii)=deltas(counts)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
			counts=counts+1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
		else if(dof(ii)==1) then                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
			disp(ii)=deltaf(countf)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
			countf=countf+1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
		end if                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	!the final answers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	force=matmul(k,disp)+  fem	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                            
							                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
!output--------------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	!newwwwwwwwwwwwww(element forces)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
	write (*,102) "Output - Forces", "-------------------"                                                                                                                                                                                                                                                                                                                                                                                                                                         
	write (3,102) "Output", "------"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	write (*,103) "Element forces in global co-ordinate system are as follows: "                                                                                                                                                                                                                                                                                                                                                                                                                                       
	write (3,103) "Element forces in global co-ordinate system are as follows: "                                                                                                                                                                                                                                                                                                                                                                                                                                       
	write (*,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	write (3,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    do i=1,num_elem                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	    f_el=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
		kg=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
		scu=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
        delta_el=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
		call kglobal(element_backup(i,8),element_backup(i,10),element_backup(i,6)*1000,cos(element_backup(i,7)),sin(element_backup(i,7)),kg)                                                                                                                                                                                                                                                                                                                                                         
	    delta_el(1:4)=disp(2*element_backup(i,11)-1:2*element_backup(i,12))                                                                                                                                                                                                                                                                                                                                                                                                                                            
		scu(1)=fem(2*(element(i,11))-1)
		scu(2)=fem(2*(element(i,11))-0)
		scu(3)=fem(2*(element(i,12))-1)
		scu(4)=fem(2*(element(i,12))-0)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
		f_el=matmul(kg,delta_el)!-scu  
		if((element(i,4)-element(i,2))*f_el(1)>0)    truss="C"
		if((element(i,4)-element(i,2))*f_el(1)<0)    truss="T"
		if(f_el(1)==0.and.f_el(2)==0)				 truss="N"
		if((element(i,5)-element(i,3))*f_el(2)>0)	 truss="C"
		if((element(i,5)-element(i,3))*f_el(2)<0)	 truss="T"                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (*,106) "   elem num.", "   axial force (n)", "   compression/tension"                                                                                                                                                                                                                                                                                                                                                                                                           
	write (3,106) "   elem num.", "   axial force (n)", "   compression/tension"                                                                                                                                                                                                                                                                                                                                                                                                                
	write (*,101) "----------------------------------------------------------"                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (3,101) "----------------------------------------------------------"                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (*,*) i                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
	write (3,*) i  
	QQQ= (element(i,8)*element(i,10)/element(i,6))*(disp(2*element(i,11)-1)*cos(element(i,7))+disp(2*element(i,11))*sin(element(i,7))-disp(2*element(i,12)-1)*cos(element(i,7))-disp(2*element(i,12))*sin(element(i,7)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
    	write (*,217) QQQ , truss                                                                                                                                                                                                                                                                                                                                                                                                                                           
		write (3,217)  sqrt(f_el(1)**2+f_el(2)**2)  ,truss       
		QQQ=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	write (*,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	write (3,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	write (*,100) "Press return to proceed "                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	result = getcharqq ( )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	!nodal displacements                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
		write (*,102) "Output - Nodal displacements", "----------------------------"                                                                                                                                                                                                                                                                                                                                                                                                                                      
	write (*,103) "Nodal displacements in global co-ordinate system are as follows: "                                                                                                                                                                                                                                                                                                                                                                                                                                  
	write (3,103) "Nodal displacements in global co-ordinate system are as follows: "                                                                                                                                                                                                                                                                                                                                                                                                                                  
	write (*,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	write (3,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	write (*,106) "node num.", "x disp. (mm)", "y disp. (mm)"                                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (3,106) "node num.", "x disp. (mm)", "y disp. (mm)"                                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (*,101) "---------------------------------------------------"                                                                                                                                                                                                                                                                                                                                                                                                                        
	write (3,101) "---------------------------------------------------"                                                                                                                                                                                                                                                                                                                                                                                                                        
	do i=1,num_node                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		write (*,115) i, disp(2*i-1), disp(2*i-0)                                                                                                                                                                                                                                                                                                                                                                                                                                                         
		write (3,115) i, disp(2*i-1), disp(2*i-0)                                                                                                                                                                                                                                                                                                                                                                                                                                                          
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	write (3,101) "---------------------------------------------------------------------------"                                                                                                                                                                                                                                                                                                                                                                                                                        
	close(3)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	write (*,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	write (*,100) "Press return to proceed "                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	result = getcharqq ( )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
call clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
!format specifications-----------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
100 format (x,a,x,\)										!question                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
101 format (x,a,x,i3,a)										!text                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
102 format (/,x,a,/,x,a,/,x," ")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
103 format (/,x,a,x,i3,a)									!return+text                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
104 format (/,x,a,x,\)										!return+question                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
105 format (/,x,a,x,i3,a)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
106 format (/,x,a,t20,a,t40,a,t60,a)						!section properties table                                                                                                                                                                                                                                                                                                                                                                                                                                                 
107 format (x,f3.0,t20,es15.4,t40,es15.4,t60,es15.5)		!section properties table                                                                                                                                                                                                                                                                                                                                                                                                                                     
108 format (/,x,5(a,a1))									!return+use ofascii code in the text                                                                                                                                                                                                                                                                                                                                                                                                                                               
109 format (20(/,3x,a))										!list of people's name                                                                                                                                                                                                                                                                                                                                                                                                                                                             
110 format (/,x,a1,20(a,a1))								!return+ascii                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
111 format (2x,a100)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
112 format (58x,a30)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
113 format (13(/))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
114 format (x,5(a,a1))										!use of ascii code in the text                                                                                                                                                                                                                                                                                                                                                                                                                                                      
115 format (x,i3,t15,es15.6,t35,es15.6,t60,es15.6)			!section properties table                                                                                                                                                                                                                                                                                                                                                                                                                                      
116 format (70x,a26)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
117 format (x,t20,es15.6,t40,es15.6,t60,es15.6)	            !newwwwwwwwwwwwww                                                                                                                                                                                                                                                                                                                                                                                                                                       
118 format (f7.3)                             
217 format (x,t20,es15.6,t42,a1)	            !newwwwwwwwwwwwww                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
!getch---------------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	write (*,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	print*,'The output is also printed to "output.txt" file'                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	write (*,*)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	write (*,*) "Press any key to terminate"                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	result = getcharqq ( )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	end program truss_analysis                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
!subroutines---------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
subroutine inverse (mat,invmat,n)       !inverse of matrix by gauss-jordan method                                                                                                                                                                                                                                                                                                                                                                                                                                   
	implicit none                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
	integer::n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
	real*8::mat(n,n), invmat(n,n), tempmat(n,n)                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	!local variables declerations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
	real*8::b(n,n), c, d, temp(n), det                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	integer::i,j,k,m,imax(1),ipvt(n)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
	tempmat=mat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	b=mat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	ipvt=(/(i,i=1,n)/)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	do k=1,n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
		imax=maxloc(abs(b(k:n,k)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
		m=k-1+imax(1)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
		if (m/=k) then                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
			ipvt((/m,k/))=ipvt((/k,m/))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
			b((/m,k/),:)=b((/k,m/),:)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
		end if                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
		d=1/b(k,k)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
		temp=b(:,k)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
		do j=1,n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
			c=b(k,j)*d                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
			b(:,j)=b(:,j)-temp*c                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
			b(k,j)=c                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
		end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
		b(:,k)=temp*(-d)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
		b(k,k)=d                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	mat(:,ipvt)=b                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
	invmat=mat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
	mat=tempmat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
end subroutine inverse                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
!---------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                                  
subroutine kglobal (e,a,l,c,s,kg)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
real*8 e,a,l,c,s                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
	real*8, dimension(6,6)::kg                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
	do qq=1,6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
		do rr=1,6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
			kg(qq,rr)=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
		end do
	t=e*a/l                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
	end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
	kg(1,1)=t*c*c
	kg(1,2)=t*c*s
	kg(1,3)=t*c*c*(-1)
	kg(1,4)=t*c*s*(-1)
	kg(2,1)=t*c*s
	kg(2,2)=t*s*s
	kg(2,3)=t*c*s*(-1)
	kg(2,4)=t*s*s*(-1)
	kg(3,1)=t*c*c*(-1)
	kg(3,2)=t*c*s*(-1)
	kg(3,3)=t*c*c
	kg(3,4)=t*c*s
	kg(4,1)=t*c*s*(-1)
	kg(4,2)=t*s*s*(-1)
	kg(4,3)=t*c*s
	kg(4,4)=t*s*s                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
end subroutine kglobal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
!---------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
subroutine clscreen (fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
use dfwin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
    use dflib                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    use dfwin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
! begin data declarations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	implicit real*8 (a-z)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    integer lines,length                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
    logical status                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    integer handlee                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	integer nlines, ncols                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    logical lstat                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    type(t_coord) wpos                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	type(t_small_rect) sr                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    type(t_console_screen_buffer_info) cinfo                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	!go back to the top                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
     wpos.x = 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
     wpos.y = 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
     lstat = setconsolecursorposition(fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                
do i=1,300                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
print '(80(" "))'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
end do                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
	!go back to the top                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
     wpos.x = 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
     wpos.y = 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
     lstat = setconsolecursorposition(fhandle, wpos)                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
end subroutine clscreen                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
!-------------------------------------------------------------------------------------------------------------------------------------                                                                                                                                                                                                                                                                                                                                                                              
